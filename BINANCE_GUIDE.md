# Binance 自动交易集成指南

## 📋 功能说明

本模块实现了基于 **Alpha + FOMO 双信号** 的 **Binance 合约自动交易**功能：

- ✅ **合约交易**：使用 Binance USDT 永续合约，支持做多
- ✅ **杠杆支持**：可配置 1-125 倍杠杆（建议 5-10x）
- ✅ **双信号确认**：必须同时收到 Alpha 和 FOMO 两个信号才会执行买入
- ✅ **时间窗口控制**：两个信号必须在配置的时间窗口内出现
- ✅ **顺序无关**：先收到 Alpha 或 FOMO 都可以，只要在时间窗口内完成双信号即可
- ✅ **自动去重**：同一币种完成交易后自动清除信号缓存，避免重复开仓
- ✅ **测试网支持**：可先在合约测试网验证，确认无误后再切换到正式网

## 🚀 快速开始

### 1. 获取 Binance 合约 API 密钥

#### 合约测试网（强烈推荐先用这个）
1. 访问 [Binance 合约测试网](https://testnet.binancefuture.com/)
2. 使用邮箱注册或 GitHub 账号登录
3. 点击右上角的 API Key 图标
4. 创建新的测试 API Key
5. **测试网的资金是虚拟的，可以免费获取 USDT**
6. 保存 API Key 和 Secret Key

#### 正式网（真实交易 - 谨慎使用）
1. 登录 [Binance](https://www.binance.com/)
2. 进入 **合约账户 → API 管理**
3. 创建新的 API Key
4. **重要安全设置**：
   - ✅ 启用 "读取信息" 权限
   - ✅ 启用 "期货交易" 权限（不是现货！）
   - ❌ 不要启用 "提现" 权限（安全考虑）
   - ✅ 绑定 IP 地址（强烈推荐）
   - ✅ 设置每日提现限额为 0
5. 保存 API Key 和 Secret Key
6. **确保合约账户有 USDT 余额**（需要从现货账户划转）

### 2. 配置文件设置

编辑 `config.py`，添加以下配置：

```python
# ==================== Binance API 配置（合约交易）====================

# Binance API Key（需要开启 "期货交易" 权限）
BINANCE_API_KEY = "your_api_key_here"

# Binance API Secret
BINANCE_API_SECRET = "your_api_secret_here"

# 是否使用测试网络（强烈建议先用测试网验证）
# True: 合约测试网（虚拟资金，无风险）
# False: 合约正式网（真实交易，有风险）
BINANCE_TESTNET = True

# 是否启用自动交易（谨慎开启！）
# False: 只记录信号，不实际交易（安全模式）
# True: 自动执行交易
BINANCE_TRADE_ENABLED = False

# 每次开仓使用的保证金（USDT）
# 注意：这是保证金金额，实际名义价值 = 保证金 × 杠杆
# 例如：保证金 20 USDT × 5 倍杠杆 = 100 USDT 名义价值
BINANCE_TRADE_AMOUNT_USDT = 20

# 杠杆倍数（1-125）
# 建议设置：
#   新手或保守: 1-3x
#   一般风险: 5-10x
#   激进策略: 10-20x
# ⚠️ 警告：高杠杆高风险，可能快速爆仓！
BINANCE_LEVERAGE = 5

# 最小订单金额（USDT）- Binance 合约最低限制
BINANCE_MIN_ORDER_USDT = 5

# 信号有效时间窗口（分钟）
# 两个信号必须在此时间内都出现才会执行开仓
# 例如：30 表示 30 分钟内必须同时收到 Alpha 和 FOMO
BINANCE_SIGNAL_TIMEOUT_MINUTES = 30
```

### 3. 安装依赖

如果还没有安装 requests，请运行：

```bash
pip install requests
```

### 4. 测试配置

运行测试脚本验证配置：

```bash
python test_binance_trader.py
```

这个测试会：
- ✅ 测试双信号逻辑（不需要 API Key）
- ✅ 测试 API 连接（需要 API Key）
- ✅ 显示账户余额
- ✅ 获取实时价格

### 5. 开始使用

确认测试通过后，正常启动程序：

```bash
python start_with_chrome.py
```

或双击 `启动.bat`

## 💡 工作原理

### 合约交易说明

本工具使用 **USDT 永续合约**进行交易：

- **交易类型**：永续合约（Perpetual Futures）
- **方向**：做多（BUY/LONG）
- **订单类型**：市价单（快速成交）
- **保证金模式**：全仓模式
- **结算资产**：USDT

**示例计算**：
```
假设配置：
- 保证金: 20 USDT
- 杠杆: 5x
- BTC 价格: 50,000 USDT

开仓数量 = (保证金 × 杠杆) / 价格
         = (20 × 5) / 50,000
         = 0.002 BTC

名义价值 = 100 USDT
强制平仓价格（约）= 开仓价 × (1 - 1/杠杆)
                  = 50,000 × (1 - 1/5)
                  = 40,000 USDT（下跌 20% 爆仓）
```

### 双信号逻辑流程

```
1. 收到 BTC 的 Alpha 信号
   └─> 记录到缓存，等待 FOMO 信号...

2. 在 30 分钟内收到 BTC 的 FOMO 信号
   └─> ✅ 双信号确认！
       └─> 设置杠杆 (5x)
           └─> 检查账户余额
               └─> 计算开仓数量
                   └─> 执行市价做多 (保证金 20 USDT)
                       └─> 清除信号缓存
               
3. 如果 30 分钟内没收到另一个信号
   └─> ⏱️ 信号过期，自动清除
```

### 信号示例

**场景 1：双信号成功（推荐）**
```
10:00 - 收到 BTC Alpha 信号 → 等待 FOMO...
10:15 - 收到 BTC FOMO 信号 → ✅ 执行开多！
        开仓价格: $50,000
        保证金: 20 USDT
        杠杆: 5x
        数量: 0.002 BTC
        名义价值: 100 USDT
```

**场景 2：顺序无关**
```
10:00 - 收到 ETH FOMO 信号 → 等待 Alpha...
10:20 - 收到 ETH Alpha 信号 → ✅ 执行开多！
```

**场景 3：超时未完成**
```
10:00 - 收到 SOL Alpha 信号 → 等待 FOMO...
10:45 - 超过 30 分钟，信号过期 → ❌ 不执行
```

**场景 4：不同币种独立**
```
10:00 - 收到 BTC Alpha 信号 → 等待 BTC FOMO...
10:10 - 收到 ETH FOMO 信号 → 等待 ETH Alpha...
10:20 - 收到 BTC FOMO 信号 → ✅ 开多 BTC！
10:30 - 收到 ETH Alpha 信号 → ✅ 开多 ETH！
```

## ⚙️ 配置详解

### BINANCE_TESTNET（推荐配置）

**测试阶段（推荐）：**
```python
BINANCE_TESTNET = True           # 使用测试网
BINANCE_TRADE_ENABLED = False    # 先不开启交易，只看日志
```

**验证阶段：**
```python
BINANCE_TESTNET = True           # 继续用测试网
BINANCE_TRADE_ENABLED = True     # 开启交易，用虚拟资金测试
```

**正式使用（谨慎）：**
```python
BINANCE_TESTNET = False          # 切换到正式网
BINANCE_TRADE_ENABLED = True     # 真实交易
BINANCE_TRADE_AMOUNT_USDT = 20   # 建议从小额开始
```

### BINANCE_TRADE_AMOUNT_USDT（保证金金额建议）

- **测试阶段**: 5-20 USDT
- **小额试水**: 10-20 USDT
- **正常使用**: 20-50 USDT
- **高资金量**: 50-200 USDT
- **根据个人资金量和风险承受能力调整**

**重要**：记住这是保证金，实际控制的资金 = 保证金 × 杠杆

### BINANCE_LEVERAGE（杠杆倍数建议）

- **极度保守**: 1x（无杠杆，等同现货）
- **保守策略**: 2-3x（适合新手）
- **平衡策略**: 5-10x（推荐）
- **激进策略**: 10-20x（高风险）
- **极度激进**: 20x+（不推荐，极易爆仓）

**爆仓距离参考**：
- 1x 杠杆：下跌 100% 爆仓（基本不会）
- 5x 杠杆：下跌 20% 爆仓
- 10x 杠杆：下跌 10% 爆仓
- 20x 杠杆：下跌 5% 爆仓
- 50x 杠杆：下跌 2% 爆仓

### BINANCE_SIGNAL_TIMEOUT_MINUTES（建议值）

- **激进策略**: 15-30 分钟（快速响应，但可能错过）
- **平衡策略**: 30-60 分钟（推荐）
- **保守策略**: 60-120 分钟（等待更长时间）

## 🔒 安全建议

1. **API 密钥安全**
   - ❌ 不要启用 "提现" 权限
   - ✅ 只启用 "读取信息" 和 "期货交易" 权限
   - ✅ 绑定 IP 地址（强烈推荐）
   - ✅ 设置每日提现限额为 0
   - ✅ 定期更换 API 密钥
   - ❌ 不要将 `config.py` 提交到 Git

2. **资金管理（合约特别重要！）**
   - ✅ 先在合约测试网充分测试
   - ✅ 从极小额开始（5-10 USDT 保证金）
   - ✅ 只投入可承受 **完全损失** 的资金
   - ✅ 合约账户只放交易资金，不要放全部资产
   - ✅ 定期提取利润到现货账户
   - ✅ 建议合约账户资金不超过总资产的 10-20%

3. **杠杆风险控制（关键！）**
   - ✅ 新手务必从低杠杆开始（1-3x）
   - ✅ 理解爆仓机制和强制平仓价
   - ❌ 不要使用超过 10x 的杠杆（除非你很有经验）
   - ✅ 市场波动大时降低杠杆或暂停交易
   - ✅ 关注账户的维持保证金率
   - ⚠️ 记住：合约可以让你快速翻倍，也可以快速归零

4. **仓位和止损**
   - ✅ 手动设置止损位（重要！）
   - ✅ 单个币种仓位不超过总资金的 20%
   - ✅ 所有持仓总价值建议不超过账户资金的 3-5 倍
   - ✅ 定期手动止盈/止损
   - ✅ 不要因为双信号就盲目开仓，注意市场环境
   - ✅ 遇到连续亏损立即停止交易，检查策略

5. **监控和日志**
   - ✅ 定期查看 `valuescan.log`
   - ✅ 关注 Telegram 通知
   - ✅ 实时监控 Binance 合约账户
   - ✅ 关注持仓盈亏和爆仓风险
   - ✅ 遇到异常立即停止程序
   - ✅ 每天检查账户状况和持仓列表

## 📊 日志说明

程序运行时会在日志中显示详细信息：

### 信号记录
```
📝 记录 BTC 的 Alpha 信号
⏳ BTC 已有 Alpha 信号，等待 FOMO 信号...
```

### 双信号确认
```
✅ BTC 同时满足 Alpha 和 FOMO 双信号条件！
🎯 执行双信号买入: BTC
```

### 交易执行
```
⚙️ 设置 BTCUSDT 杠杆: 5x
✅ 杠杆设置成功: 5x
💵 当前标记价格: $50000.00
💰 可用余额: 100.00 USDT
� 未实现盈亏: 0.00 USDT
�💸 计划买入:
   保证金: 20.00 USDT
   杠杆: 5x
   名义价值: 100.00 USDT
   合约数量: 0.002
📝 创建合约市价做多单: BTCUSDT, 数量: 0.002
✅ 订单创建成功:
   订单ID: 123456789
   状态: FILLED
   成交数量: 0.002
   成交均价: $50000.00
✅ 双信号买入成功: BTC
```

### 信号过期
```
🕐 ETH 的 Alpha 信号已过期，移除
```

## ❓ 常见问题

### Q1: 合约测试网在哪里获取资金？

A: 访问 https://testnet.binancefuture.com/，登录后：
- 点击页面右上角的 "Faucet" 或钱包图标
- 免费获取测试用的虚拟 USDT（通常一次 10,000 USDT）
- 可以多次获取用于测试
- 测试网资金完全虚拟，不是真钱

### Q2: 如何确认双信号逻辑正常工作？

A: 运行测试脚本：
```bash
python test_binance_trader.py
```
查看日志，确认：
- ✅ 单个信号会等待另一个信号
- ✅ 双信号同时出现会触发交易逻辑
- ✅ 不同币种的信号独立处理

### Q3: 交易失败怎么办？

A: 检查以下几点：
1. API Key 是否正确配置
2. API 权限是否包含 "期货交易"（不是现货！）
3. **合约账户** USDT 余额是否充足
4. 交易对是否在 Binance 合约上存在
5. 保证金是否满足最小要求
6. 查看 `valuescan.log` 了解具体错误

### Q4: 能否只交易 Alpha 或只交易 FOMO？

A: 不能。本模块的设计理念是**双信号确认**，降低风险。如果需要单信号交易，需要修改代码。

### Q5: 如何停止自动交易？

A: 两种方式：
1. **临时停止**：在 `config.py` 中设置 `BINANCE_TRADE_ENABLED = False`
2. **完全停止**：按 Ctrl+C 停止程序

### Q6: 会重复开仓同一个币种吗？

A: 不会。执行一次开仓后，该币种的信号缓存会被清除，需要重新收到双信号才会再次开仓。

### Q7: 支持平仓/止损吗？

A: 当前版本只支持开多（做多）。平仓需要你根据策略手动执行：
- 在 Binance 合约界面手动平仓
- 或者设置止盈/止损单
- **强烈建议开仓后立即设置止损！**

### Q8: 什么是爆仓？如何避免？

A: **爆仓**：当价格下跌到一定程度，保证金不足以维持仓位时，系统会强制平仓，损失全部保证金。

**避免方法**：
- 使用低杠杆（5x 以下更安全）
- 不要满仓交易
- 及时设置止损
- 关注强制平仓价格
- 行情剧烈波动时及时减仓

### Q9: 现货账户和合约账户的区别？

A: 
- **现货账户**：买卖真实的币，不能开杠杆
- **合约账户**：交易合约，支持杠杆和做空
- 两个账户资金独立，需要手动划转
- **本工具使用合约账户，确保有余额！**

### Q10: 测试成功后如何切换到正式网？

A: 在 `config.py` 中：
1. 将 `BINANCE_TESTNET` 改为 `False`
2. 更换为正式网的 API Key 和 Secret
3. **确保合约账户有足够的 USDT**
4. **建议从最小额开始测试！**

## 📈 进阶功能（未来可扩展）

可以考虑添加的功能：

1. **止盈止损**
   - 自动止盈（如 +20%）
   - 自动止损（如 -10%）
   - 移动止损

2. **仓位管理**
   - 记录持仓
   - 计算盈亏
   - 最大持仓数量限制

3. **信号过滤**
   - 价格区间过滤
   - 24h 涨跌幅过滤
   - 交易量过滤

4. **通知增强**
   - 交易成功发送 Telegram 通知
   - 持仓盈亏定期通知

## 📞 获取帮助

- 查看日志文件: `valuescan.log`
- 运行测试脚本: `python test_binance_trader.py`
- 检查配置: 确认 `config.py` 中所有参数正确

## ⚠️ 免责声明

- 本工具仅供学习和研究使用
- **合约交易存在极高风险，可能导致本金全部损失（爆仓）**
- **杠杆交易会放大收益，也会放大损失**
- 使用本工具进行的任何交易，风险由用户自行承担
- 作者不对任何交易损失承担责任
- 请在充分了解合约交易机制和风险的前提下使用
- **强烈建议**：
  - 先在测试网充分测试
  - 了解合约交易、杠杆和爆仓机制
  - 只投入可以完全损失的资金
  - 从最小额和低杠杆开始
  - 务必设置止损

## 📚 推荐学习资源

在使用合约交易前，建议先学习：

1. **Binance 官方教程**
   - 合约交易新手指南
   - 杠杆和保证金说明
   - 强制平仓机制

2. **风险管理**
   - 仓位管理
   - 止损止盈策略
   - 资金管理原则

3. **市场分析**
   - 技术分析基础
   - 风险识别
   - 市场情绪判断

---

**⚠️ 再次提醒：合约交易风险极高，请务必谨慎！先在测试网验证！** 🚀
