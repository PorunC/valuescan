# ValueScan 项目架构总览

## 🎯 项目愿景

构建一个完整的加密货币交易解决方案，从信号捕捉到自动化交易执行的全流程自动化。

## 📐 系统架构

```
┌─────────────────────────────────────────────────────────────┐
│                    ValueScan.io API                         │
│              (加密货币交易信号源)                              │
└────────────────────┬────────────────────────────────────────┘
                     │
                     ▼
┌─────────────────────────────────────────────────────────────┐
│              Signal Monitor Module                          │
│              信号监控模块 (signal_monitor/)                   │
│                                                              │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐     │
│  │ API Monitor  │→ │   Message    │→ │  Telegram    │     │
│  │  监听API请求  │  │   Handler    │  │    Bot       │     │
│  │              │  │  解析+去重     │  │  消息推送     │     │
│  └──────────────┘  └──────────────┘  └──────────────┘     │
│                                                              │
│  信号类型: Type 100, 108, 109, 110, 111, 112, 113, 114     │
└────────────────────┬────────────────────────────────────────┘
                     │
                     │ 关键信号
                     │ FOMO (113, 112)
                     │ Alpha (110)
                     │
                     ▼
┌─────────────────────────────────────────────────────────────┐
│           Binance Trader Module                             │
│           自动化交易模块 (binance_trader/)                    │
│                                                              │
│  ┌──────────────────────────────────────────────────────┐  │
│  │         Signal Aggregator (信号聚合器)                │  │
│  │  ┌─────────────────────────────────────────────┐     │  │
│  │  │  时间窗口匹配 (5分钟默认)                     │     │  │
│  │  │  • FOMO 信号缓存                             │     │  │
│  │  │  • Alpha 信号缓存                            │     │  │
│  │  │  • 匹配同一标的                               │     │  │
│  │  │  • 计算信号评分 (0-1)                        │     │  │
│  │  └─────────────────────────────────────────────┘     │  │
│  │                    ↓                                   │  │
│  │              Confluence Signal                         │  │
│  │           (高质量聚合信号输出)                          │  │
│  └──────────────────┬───────────────────────────────────┘  │
│                     │                                       │
│                     ▼                                       │
│  ┌──────────────────────────────────────────────────────┐  │
│  │         Risk Manager (风险管理器)                     │  │
│  │  ┌─────────────────────────────────────────────┐     │  │
│  │  │  • 检查仓位限制 (单币10%, 总仓50%)           │     │  │
│  │  │  • 检查每日交易次数 (20笔)                   │     │  │
│  │  │  • 检查每日亏损限制 (5%)                     │     │  │
│  │  │  • 计算建议仓位大小                           │     │  │
│  │  │  • 计算止损止盈价格                           │     │  │
│  │  └─────────────────────────────────────────────┘     │  │
│  │                    ↓                                   │  │
│  │          Trade Recommendation                          │  │
│  │           (BUY/SKIP + 参数)                            │  │
│  └──────────────────┬───────────────────────────────────┘  │
│                     │                                       │
│                     ▼                                       │
│  ┌──────────────────────────────────────────────────────┐  │
│  │         Binance Trader (交易执行器)                   │  │
│  │  ┌─────────────────────────────────────────────┐     │  │
│  │  │  1. 市价买入                                  │     │  │
│  │  │  2. 设置止损订单 (-3%)                        │     │  │
│  │  │  3. 设置止盈订单 1 (+5%, 50%仓位)             │     │  │
│  │  │  4. 设置止盈订单 2 (+10%, 剩余仓位)           │     │  │
│  │  │  5. 监控持仓状态                              │     │  │
│  │  └─────────────────────────────────────────────┘     │  │
│  └──────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
                     │
                     ▼
┌─────────────────────────────────────────────────────────────┐
│                  Binance Exchange                           │
│                  (币安交易所)                                │
└─────────────────────────────────────────────────────────────┘
```

## 🔄 数据流详解

### 1. 信号捕捉阶段
```
ValueScan API → DrissionPage 拦截 → 解析响应 → 去重 → Telegram 通知
```

### 2. 信号聚合阶段
```
原始信号 → 类型过滤 → 时间窗口缓存 → 标的匹配 → 评分计算 → 聚合信号
```

### 3. 风险评估阶段
```
聚合信号 → 风控检查 → 仓位计算 → 止损止盈计算 → 交易建议
```

### 4. 交易执行阶段
```
交易建议 → API调用 → 订单执行 → 状态监控 → 持仓管理
```

## 🧩 模块依赖关系

```
signal_monitor/ (独立模块)
├── 可单独运行
├── 提供信号监控功能
└── 输出到 Telegram

binance_trader/ (可独立或集成)
├── 可从 signal_monitor 接收信号
├── 也可接收外部信号源
├── 内部完全自包含
└── 输出到 Binance 交易所
```

## 🎓 核心概念解释

### Signal Confluence (信号聚合)

**定义**: 多个独立信号在短时间内同时指向同一标的，大幅提升交易成功率。

**为什么有效**:
1. **降低噪音** - 单一信号可能是市场噪音，多信号确认降低假信号
2. **提升准确性** - 类似技术分析中的"共振"概念
3. **情绪+价值** - FOMO代表市场情绪热度，Alpha代表基本面机会
4. **时间敏感** - 加密市场快速，信号必须在短时间内有效

**实现方式**:
```python
# 伪代码
if (有FOMO信号 && 有Alpha信号 &&
    同一标的 &&
    时间差 < 5分钟 &&
    信号评分 > 0.6):
    执行交易()
```

### Risk Management (风险管理)

**多层防护机制**:

1. **仓位层面**
   - 单币种不超过10%总资金
   - 总持仓不超过50%总资金
   - 保留至少50%现金

2. **交易层面**
   - 每日最多20笔交易
   - 每日亏损5%自动停止
   - 严格止损机制

3. **订单层面**
   - 自动设置止损单
   - 分批止盈策略
   - 实时监控执行

### Position Sizing (仓位管理)

**动态计算公式**:
```python
单币种可用资金 = 总资金 × 10%
实际购买资金 = min(单币种可用资金, 可用余额)
购买数量 = 实际购买资金 / 当前价格
调整后数量 = 购买数量 × (0.5 + 0.5 × 信号评分)
```

**示例**:
- 账户总余额: 10,000 USDT
- BTC 当前价格: 50,000 USDT
- 信号评分: 0.8

计算:
```
单币种限额 = 10,000 × 10% = 1,000 USDT
基础购买量 = 1,000 / 50,000 = 0.02 BTC
评分调整 = 0.02 × (0.5 + 0.5 × 0.8) = 0.018 BTC
最终购买 = 0.018 BTC (约 900 USDT)
```

## 🔐 安全性设计

### API 密钥管理
- 配置文件不提交到版本控制
- 建议使用只读+交易权限，禁用提现
- 设置IP白名单
- 定期轮换密钥

### 风控熔断
- 每日亏损达到阈值自动停止
- 异常情况可手动暂停
- 所有操作都有日志记录

### 测试网优先
- 强烈建议先用测试网验证
- 测试网完全模拟真实环境
- 无风险验证策略有效性

## 📊 性能指标

### 信号监控模块
- 延迟: < 1秒
- 准确率: 100% (API直接拦截)
- 去重率: 100%
- 资源占用: ~200MB 内存

### 交易执行模块
- 信号处理: < 100ms
- 订单执行: 通常 < 2秒
- 监控频率: 每分钟
- 并发支持: 10+ 交易对

## 🚀 部署建议

### 开发环境
```
Windows/macOS
├── signal_monitor (有头模式)
└── binance_trader (测试网)
```

### 生产环境
```
Linux VPS
├── signal_monitor (无头模式)
└── binance_trader (生产环境，小额启动)
```

### 最佳实践
1. **阶段 1**: 本地信号监控 → 观察信号质量
2. **阶段 2**: 测试网交易 → 验证策略逻辑
3. **阶段 3**: 小额生产 → 验证实际效果
4. **阶段 4**: 正常仓位 → 持续优化

## 🔮 未来扩展

### 短期计划 (v1.1)
- [ ] 信号监控与交易模块直接集成
- [ ] Telegram 交易通知
- [ ] Web 监控仪表板
- [ ] 更多技术指标过滤

### 中期计划 (v1.2)
- [ ] 回测框架
- [ ] 机器学习信号评分
- [ ] 多交易所支持
- [ ] 动态止损策略

### 长期计划 (v2.0)
- [ ] 策略市场（用户自定义策略）
- [ ] 社区信号共享
- [ ] 高频交易支持
- [ ] 跨链套利

## 📚 技术栈

### 信号监控
- **DrissionPage**: 浏览器自动化
- **SQLite**: 消息去重存储
- **Requests**: Telegram API 调用

### 自动交易
- **python-binance**: Binance API 客户端
- **dataclasses**: 数据结构
- **logging**: 完善的日志系统

### 通用
- **Python 3.8+**: 主要开发语言
- **跨平台支持**: Windows/Linux/macOS

## 🤝 贡献指南

欢迎贡献代码、提交 Issue 或改进文档！

重点关注领域：
1. 策略优化和回测
2. 风险管理机制改进
3. 新交易所集成
4. 性能优化
5. 文档完善

---

**更新日期**: 2025-10-13
**项目版本**: v1.0.0
**文档版本**: v1.0
